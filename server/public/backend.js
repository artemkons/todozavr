(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=require("express");var t=e.n(n);const r=require("express-graphql"),o=require("mongoose");var a=e.n(o);const u=(0,require("graphql").buildSchema)("\n  type Todo {\n    id:ID!\n    title: String!\n    text: String!\n    done: Boolean!\n    deadline: String\n  }\n\n  type Sort {\n    id: ID!\n    order: Int!,\n    parameter: String!\n  }\n\n  type Query {\n    todo(id: ID!): Todo\n    allTodos: [Todo!]!\n    getSort: Sort!\n  }\n\n  type Mutation {\n    addTodo(title: String!, text: String, deadline: String): Todo!\n    deleteTodo(id: ID!): Todo\n    editTodo(id: ID!, title: String!, text: String!, deadline: String): Todo!\n    doneTodo(id: ID!): Todo! \n    setSort(order: Int, parameter: String): Sort!\n    unchekAllChecked: Query\n    deleteAllChecked: Query\n  }\n"),i=require("@babel/runtime/helpers/asyncToGenerator");var s=e.n(i);const d=require("@babel/runtime/regenerator");var c=e.n(d),p=new o.Schema({title:String,text:String,done:{type:Boolean,default:!1},deadline:Date});const l=a().model("Todo",p);var f=new o.Schema({order:{type:Number,default:0},parameter:{type:String,default:"done"}});const h=a().model("Sort",f);var y,m,x,v,g,w,S,b,T,k;const I={allTodos:(k=s()(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.find({});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return k.apply(this,arguments)}),todo:(T=s()(c().mark((function e(n){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.id,e.next=3,l.findById(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)}),addTodo:(b=s()(c().mark((function e(n){var t,r,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.title,r=n.text,o=n.deadline,a=new l({title:t,text:r||"",deadline:o}),e.next=4,a.save();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)}),deleteTodo:(S=s()(c().mark((function e(n){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.id,e.next=3,l.findByIdAndDelete(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)}),editTodo:(w=s()(c().mark((function e(n){var t,r,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.id,r=n.title,o=n.text,a=n.deadline,e.next=3,l.findByIdAndUpdate(t,{title:r,text:o,deadline:a},{new:!0});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)}),doneTodo:(g=s()(c().mark((function e(n){var t,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.id,e.next=3,l.findById(t);case 3:return(r=e.sent).done=!r.done,e.next=7,r.save();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)}),getSort:(v=s()(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.findOne();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return v.apply(this,arguments)}),setSort:(x=s()(c().mark((function e(n){var t,r,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.order,r=n.parameter,e.next=3,h.findOne();case 3:return(o=e.sent).order=null!=t?t:o.order,o.parameter=r||o.parameter,e.next=8,o.save();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)}),unchekAllChecked:(m=s()(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.updateMany({done:!0},{done:!1});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return m.apply(this,arguments)}),deleteAllChecked:(y=s()(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.deleteMany({done:!0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)})};a().connect("mongodb+srv://artemkons:123@cluster0.9mla7.mongodb.net/todos_db?retryWrites=true&w=majority",{useNewUrlParser:!0,useUnifiedTopology:!0,useFindAndModify:!1});var q=a().connection;q.on("error",(function(e){return console.log("Connection error ".concat(e))})),q.once("open",(function(){return console.log("Connected to DB!")}));var D=t()();D.use("/api",(0,r.graphqlHTTP)({schema:u,rootValue:I,graphiql:!0})),D.listen(3e3,(function(){console.log("Example app listening at http://localhost")}))})();